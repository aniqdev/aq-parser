<?php
ini_get('safe_mode') or set_time_limit(4000); // Указываем скрипту, чтобы не обрывал связь.


$items_list = file_get_contents(__DIR__.'/items-list.json');
$items_list = json_decode($items_list,1);
//sa($items_list);
$str = '111538506825
111539787764
111542599737
111561636593
111609151413
111613108364
111639885737
111658241342
111707459951
111730660111
111749513533
111750596245
111750602061
111780060638
111781192784
111781490809
111969251130
111977393326
111977393666
111977393974
111977928399
111977928433
111977928448
111977928494
111978074455
111978074501
111978074531
111979753351
111979753362
111979753367
111979753448
111979753461
111981606117
111981606127
111981606149
111981606188
111985487821
111985502827
111991506270
111992879704
111992895601
111992895887
111995789031
111995789097
111995789211
112079578740
112085262774
112127361605
112157575462
112196331506
112196331512
112196331513
112196331516
112196331518
112216500142
112216500147
112216500149
112216500155
112216500156
112216500159
112216500160
112216500162
112216500166
112247705979
112262376884
112262377903
121511708535
121577061288
121582050756
121586590186
121586590196
121606834891
121636669078
121709692523
121709692710
121709692733
121717554411
121737735479
121738706693
121738712324
121746516270
121768031829
121772955210
121792558010
121792574063
121955965099
121965995104
121965995160
121965995191
121965995197
121965995237
121966139457
121966139471
121966139477
121966139505
121968062431
121968062453
121968062501
121968062570
121970234302
121974505990
112159412520
112159412642
112159412770
112174430780
112174430836
112174432498
112181125648
112181125770
112187482588
112187661334
112187661488
112196331505
112196331514
112216500164
112247705973
112247705993
121767974647
121772396850
121965995205
121968062421
121968062441
121968062532
121970234132
121981342479
121982683003
122164239957
122179191289
122183774382
122183775565
122191975183
122197831907
122205172344
122214428082
122242021072
122242021146
122242021167
122242021196
122283795534
122283795537
122283795542';
$items_arr = explode(PHP_EOL, $str);

//sa($items_arr);
	$ebayObj = new Ebay_shopping2();
		$file = 'E:\xamp\htdocs\info-rim.ru\www\april-pics\fails2.txt';

foreach ($items_arr as $key => $ebay_id) {
	// sa($key);
	// sa($ebay_id);
	//echo $key,'<a href="http://www.ebay.de/itm/'.$ebay_id.'" target="_blank">'.$ebay_id.'</a><BR>';
	//continue;
	break;
	//if($key < 901 || $key > 1200) continue;
	$pic_urls = [];
	$pic_urls[] = 'http://hot-body.net/april-pics/ebay-april-todas/april_'.$ebay_id.'.jpg';
	$otras_arr = json_decode(file_get_contents('http://hot-body.net/april-pics/checker.php?ebay_id='.$ebay_id), true);
	if(!$otras_arr) $otras_arr = [];
	foreach ($otras_arr as $k => $value) {
		if($k === 2) continue; // эта строка убирает картинку со значками которая на втором месте
		$pic_urls[] = 'http://hot-body.net/april-pics/ebay-april-otras/'.$ebay_id.'/'.$value;
	}
	sa($pic_urls);
	$res = $ebayObj->updateItemPictureDetails($ebay_id, $pic_urls);
	unset($res['Fees']);
	sa($res);
	echo '<a href="http://www.ebay.de/itm/'.$ebay_id.'" target="_blank">'.$ebay_id.'</a>';
	echo "<HR>";
	if (!isset($res['Ack']) || $res['Ack'] !== 'Success') {
		file_put_contents($file, $ebay_id.PHP_EOL, FILE_APPEND | LOCK_EX);
	}
}


?>